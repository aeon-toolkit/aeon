"""Plot cluster labels with centers marked for Jain dataset."""

import matplotlib.pyplot as plt
import numpy as np

from aeon.clustering.density_based._density_peak import DensityPeakClusterer

# Jain dataset
test_data = np.array(
    [
        [0.85, 17.45],
        [0.75, 15.6],
        [3.3, 15.45],
        [5.25, 14.2],
        [4.9, 15.65],
        [5.35, 15.85],
        [5.1, 17.9],
        [4.6, 18.25],
        [4.05, 18.75],
        [3.4, 19.7],
        [2.9, 21.15],
        [3.1, 21.85],
        [3.9, 21.85],
        [4.4, 20.05],
        [7.2, 14.5],
        [7.65, 16.5],
        [7.1, 18.65],
        [7.05, 19.9],
        [5.85, 20.55],
        [5.5, 21.8],
        [6.55, 21.8],
        [6.05, 22.3],
        [5.2, 23.4],
        [4.55, 23.9],
        [5.1, 24.4],
        [8.1, 26.35],
        [10.15, 27.7],
        [9.75, 25.5],
        [9.2, 21.1],
        [11.2, 22.8],
        [12.6, 23.1],
        [13.25, 23.5],
        [11.65, 26.85],
        [12.45, 27.55],
        [13.3, 27.85],
        [13.7, 27.75],
        [14.15, 26.9],
        [14.05, 26.55],
        [15.15, 24.2],
        [15.2, 24.75],
        [12.2, 20.9],
        [12.15, 21.45],
        [12.75, 22.05],
        [13.15, 21.85],
        [13.75, 22],
        [13.95, 22.7],
        [14.4, 22.65],
        [14.2, 22.15],
        [14.1, 21.75],
        [14.05, 21.4],
        [17.2, 24.8],
        [17.7, 24.85],
        [17.55, 25.2],
        [17, 26.85],
        [16.55, 27.1],
        [19.15, 25.35],
        [18.8, 24.7],
        [21.4, 25.85],
        [15.8, 21.35],
        [16.6, 21.15],
        [17.45, 20.75],
        [18, 20.95],
        [18.25, 20.2],
        [18, 22.3],
        [18.6, 22.25],
        [19.2, 21.95],
        [19.45, 22.1],
        [20.1, 21.6],
        [20.1, 20.9],
        [19.9, 20.35],
        [19.45, 19.05],
        [19.25, 18.7],
        [21.3, 22.3],
        [22.9, 23.65],
        [23.15, 24.1],
        [24.25, 22.85],
        [22.05, 20.25],
        [20.95, 18.25],
        [21.65, 17.25],
        [21.55, 16.7],
        [21.6, 16.3],
        [21.5, 15.5],
        [22.4, 16.5],
        [22.25, 18.1],
        [23.15, 19.05],
        [23.5, 19.8],
        [23.75, 20.2],
        [25.15, 19.8],
        [25.5, 19.45],
        [23, 18],
        [23.95, 17.75],
        [25.9, 17.55],
        [27.65, 15.65],
        [23.1, 14.6],
        [23.5, 15.2],
        [24.05, 14.9],
        [24.5, 14.7],
        [14.15, 17.35],
        [14.3, 16.8],
        [14.3, 15.75],
        [14.75, 15.1],
        [15.35, 15.5],
        [15.95, 16.45],
        [16.5, 17.05],
        [17.35, 17.05],
        [17.15, 16.3],
        [16.65, 16.1],
        [16.5, 15.15],
        [16.25, 14.95],
        [16, 14.25],
        [15.9, 13.2],
        [15.15, 12.05],
        [15.2, 11.7],
        [17, 15.65],
        [16.9, 15.35],
        [17.35, 15.45],
        [17.15, 15.1],
        [17.3, 14.9],
        [17.7, 15],
        [17, 14.6],
        [16.85, 14.3],
        [16.6, 14.05],
        [17.1, 14],
        [17.45, 14.15],
        [17.8, 14.2],
        [17.6, 13.85],
        [17.2, 13.5],
        [17.25, 13.15],
        [17.1, 12.75],
        [16.95, 12.35],
        [16.5, 12.2],
        [16.25, 12.5],
        [16.05, 11.9],
        [16.65, 10.9],
        [16.7, 11.4],
        [16.95, 11.25],
        [17.3, 11.2],
        [18.05, 11.9],
        [18.6, 12.5],
        [18.9, 12.05],
        [18.7, 11.25],
        [17.95, 10.9],
        [18.4, 10.05],
        [17.45, 10.4],
        [17.6, 10.15],
        [17.7, 9.85],
        [17.3, 9.7],
        [16.95, 9.7],
        [16.75, 9.65],
        [19.8, 9.95],
        [19.1, 9.55],
        [17.5, 8.3],
        [17.55, 8.1],
        [17.85, 7.55],
        [18.2, 8.35],
        [19.3, 9.1],
        [19.4, 8.85],
        [19.05, 8.85],
        [18.9, 8.5],
        [18.6, 7.85],
        [18.7, 7.65],
        [19.35, 8.2],
        [19.95, 8.3],
        [20, 8.9],
        [20.3, 8.9],
        [20.55, 8.8],
        [18.35, 6.95],
        [18.65, 6.9],
        [19.3, 7],
        [19.1, 6.85],
        [19.15, 6.65],
        [21.2, 8.8],
        [21.4, 8.8],
        [21.1, 8],
        [20.4, 7],
        [20.5, 6.35],
        [20.1, 6.05],
        [20.45, 5.15],
        [20.95, 5.55],
        [20.95, 6.2],
        [20.9, 6.6],
        [21.05, 7],
        [21.85, 8.5],
        [21.9, 8.2],
        [22.3, 7.7],
        [21.85, 6.65],
        [21.3, 5.05],
        [22.6, 6.7],
        [22.5, 6.15],
        [23.65, 7.2],
        [24.1, 7],
        [21.95, 4.8],
        [22.15, 5.05],
        [22.45, 5.3],
        [22.45, 4.9],
        [22.7, 5.5],
        [23, 5.6],
        [23.2, 5.3],
        [23.45, 5.95],
        [23.75, 5.95],
        [24.45, 6.15],
        [24.6, 6.45],
        [25.2, 6.55],
        [26.05, 6.4],
        [25.3, 5.75],
        [24.35, 5.35],
        [23.3, 4.9],
        [22.95, 4.75],
        [22.4, 4.55],
        [22.8, 4.1],
        [22.9, 4],
        [23.25, 3.85],
        [23.45, 3.6],
        [23.55, 4.2],
        [23.8, 3.65],
        [23.8, 4.75],
        [24.2, 4],
        [24.55, 4],
        [24.7, 3.85],
        [24.7, 4.3],
        [24.9, 4.75],
        [26.4, 5.7],
        [27.15, 5.95],
        [27.3, 5.45],
        [27.5, 5.45],
        [27.55, 5.1],
        [26.85, 4.95],
        [26.6, 4.9],
        [26.85, 4.4],
        [26.2, 4.4],
        [26, 4.25],
        [25.15, 4.1],
        [25.6, 3.9],
        [25.85, 3.6],
        [24.95, 3.35],
        [25.1, 3.25],
        [25.45, 3.15],
        [26.85, 2.95],
        [27.15, 3.15],
        [27.2, 3],
        [27.95, 3.25],
        [27.95, 3.5],
        [28.8, 4.05],
        [28.8, 4.7],
        [28.75, 5.45],
        [28.6, 5.75],
        [29.25, 6.3],
        [30, 6.55],
        [30.6, 3.4],
        [30.05, 3.45],
        [29.75, 3.45],
        [29.2, 4],
        [29.45, 4.05],
        [29.05, 4.55],
        [29.4, 4.85],
        [29.5, 4.7],
        [29.9, 4.45],
        [30.75, 4.45],
        [30.4, 4.05],
        [30.8, 3.95],
        [31.05, 3.95],
        [30.9, 5.2],
        [30.65, 5.85],
        [30.7, 6.15],
        [31.5, 6.25],
        [31.65, 6.55],
        [32, 7],
        [32.5, 7.95],
        [33.35, 7.45],
        [32.6, 6.95],
        [32.65, 6.6],
        [32.55, 6.35],
        [32.35, 6.1],
        [32.55, 5.8],
        [32.2, 5.05],
        [32.35, 4.25],
        [32.9, 4.15],
        [32.7, 4.6],
        [32.75, 4.85],
        [34.1, 4.6],
        [34.1, 5],
        [33.6, 5.25],
        [33.35, 5.65],
        [33.75, 5.95],
        [33.4, 6.2],
        [34.45, 5.8],
        [34.65, 5.65],
        [34.65, 6.25],
        [35.25, 6.25],
        [34.35, 6.8],
        [34.1, 7.15],
        [34.45, 7.3],
        [34.7, 7.2],
        [34.85, 7],
        [34.35, 7.75],
        [34.55, 7.85],
        [35.05, 8],
        [35.5, 8.05],
        [35.8, 7.1],
        [36.6, 6.7],
        [36.75, 7.25],
        [36.5, 7.4],
        [35.95, 7.9],
        [36.1, 8.1],
        [36.15, 8.4],
        [37.6, 7.35],
        [37.9, 7.65],
        [29.15, 4.4],
        [34.9, 9],
        [35.3, 9.4],
        [35.9, 9.35],
        [36, 9.65],
        [35.75, 10],
        [36.7, 9.15],
        [36.6, 9.8],
        [36.9, 9.75],
        [37.25, 10.15],
        [36.4, 10.15],
        [36.3, 10.7],
        [36.75, 10.85],
        [38.15, 9.7],
        [38.4, 9.45],
        [38.35, 10.5],
        [37.7, 10.8],
        [37.45, 11.15],
        [37.35, 11.4],
        [37, 11.75],
        [36.8, 12.2],
        [37.15, 12.55],
        [37.25, 12.15],
        [37.65, 11.95],
        [37.95, 11.85],
        [38.6, 11.75],
        [38.5, 12.2],
        [38, 12.95],
        [37.3, 13],
        [37.5, 13.4],
        [37.85, 14.5],
        [38.3, 14.6],
        [38.05, 14.45],
        [38.35, 14.35],
        [38.5, 14.25],
        [39.3, 14.2],
        [39, 13.2],
        [38.95, 12.9],
        [39.2, 12.35],
        [39.5, 11.8],
        [39.55, 12.3],
        [39.75, 12.75],
        [40.2, 12.8],
        [40.4, 12.05],
        [40.45, 12.5],
        [40.55, 13.15],
        [40.45, 14.5],
        [40.2, 14.8],
        [40.65, 14.9],
        [40.6, 15.25],
        [41.3, 15.3],
        [40.95, 15.7],
        [41.25, 16.8],
        [40.95, 17.05],
        [40.7, 16.45],
        [40.45, 16.3],
        [39.9, 16.2],
        [39.65, 16.2],
        [39.25, 15.5],
        [38.85, 15.5],
        [38.3, 16.5],
        [38.75, 16.85],
        [39, 16.6],
        [38.25, 17.35],
        [39.5, 16.95],
        [39.9, 17.05],
    ]
)


def plot_cluster_labels_and_decision_graph():
    """Plot cluster labels with centers marked and decision graph sequentially."""
    # euclidean distance
    clusterer = DensityPeakClusterer(
        distance_metric="euclidean",
        density_threshold=8,
        distance_threshold=5,
        abnormal=False,
    )

    clusterer.fit(test_data)

    # Cluster labels visualization
    plt.figure(figsize=(12, 8))
    scatter1 = plt.scatter(
        test_data[:, 0],
        test_data[:, 1],
        c=clusterer.labels_,
        cmap="tab10",
        s=40,
        alpha=0.7,
    )

    # cluster centers
    center_points = test_data[clusterer.cluster_centers]
    plt.scatter(
        center_points[:, 0],
        center_points[:, 1],
        c="red",
        marker="X",
        s=200,
        edgecolors="black",
        linewidth=2,
        label=f"Centers ({len(clusterer.cluster_centers)})",
    )

    plt.title(
        "Jain Dataset - Cluster Labels (Euclidean Distance)",
        fontsize=16,
        fontweight="bold",
    )
    plt.xlabel("X coordinate", fontsize=12)
    plt.ylabel("Y coordinate", fontsize=12)
    plt.legend(fontsize=12)
    plt.grid(True, alpha=0.3)
    plt.colorbar(scatter1, label="Cluster ID")
    plt.tight_layout()
    plt.show()

    # Decision graph (rho vs delta)
    plt.figure(figsize=(12, 8))
    scatter2 = plt.scatter(
        clusterer.rho,
        clusterer.delta,
        c=clusterer.labels_,
        cmap="tab10",
        s=40,
        alpha=0.7,
    )

    # cluster centers in decision graph
    center_rho = clusterer.rho[clusterer.cluster_centers]
    center_delta = clusterer.delta[clusterer.cluster_centers]
    plt.scatter(
        center_rho,
        center_delta,
        c="red",
        marker="X",
        s=200,
        edgecolors="black",
        linewidth=2,
        label=f"Centers ({len(clusterer.cluster_centers)})",
    )

    # Add threshold lines to decision graph
    plt.axhline(
        y=5, color="red", linestyle="--", alpha=0.7, label="Distance Threshold = 5"
    )
    plt.axvline(
        x=8, color="orange", linestyle="--", alpha=0.7, label="Density Threshold = 8"
    )

    plt.title("Jain Dataset - Decision Graph (ρ vs δ)", fontsize=16, fontweight="bold")
    plt.xlabel("Local Density (ρ)", fontsize=12)
    plt.ylabel("Min Distance to Higher Density (δ)", fontsize=12)
    plt.legend(fontsize=12)
    plt.grid(True, alpha=0.3)
    plt.colorbar(scatter2, label="Cluster ID")
    plt.tight_layout()
    plt.show()

    # ============================================================
    # JAIN DATASET CLUSTERING RESULTS
    # ============================================================
    # Total data points: 373
    # Number of cluster centers: 4
    # Cluster centers indices: [119, 206, 284, 330]
    # Cutoff distance (dc): 1.4534
    # Unique cluster labels: [119, 206, 284, 330]
    #
    # Cluster size breakdown:
    # Cluster 119: 149 points (39.9%)
    # Cluster 206: 116 points (31.1%)
    # Cluster 284: 43 points (11.5%)
    # Cluster 330: 65 points (17.4%)
    #
    # Cluster centers in decision graph:
    # Center 1 (index 119): position=(17.00, 14.60), ρ=14.1726, δ=10.7378
    # Center 2 (index 206): position=(23.30, 4.90), ρ=16.1302, δ=40.5511
    # Center 3 (index 284): position=(33.40, 6.20), ρ=12.9314, δ=8.5131
    # Center 4 (index 330): position=(37.65, 11.95), ρ=12.1717, δ=5.5915
    #
    # Density (ρ) range: 0.0507 to 16.1302
    # Delta (δ) range: 0.1414 to 40.5511
    #
    # Threshold analysis:
    # Points with ρ ≥ 8: 213
    # Points with δ ≥ 5: 6
    # Points with both ρ ≥ 8 AND δ ≥ 5: 4

    return clusterer


if __name__ == "__main__":
    plot_cluster_labels_and_decision_graph()
